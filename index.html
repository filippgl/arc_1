<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Test</title>
    <!-- Используем библиотеку AR.js версии 3.x с минимальной конфигурацией -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        #arjsDebugUIContainer {
            display: none;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <script>
        // Простая инициализация AR.js с Three.js
        window.onload = function() {
            // Инициализация AR.js
            const arToolkitSource = new THREEx.ArToolkitSource({
                sourceType: 'webcam',
                sourceWidth: window.innerWidth,
                sourceHeight: window.innerHeight,
                displayWidth: window.innerWidth,
                displayHeight: window.innerHeight
            });

            // Обработка изменения размера окна
            arToolkitSource.init(function onReady() {
                arToolkitSource.onResize(renderer.domElement);
            });

            window.addEventListener('resize', function() {
                arToolkitSource.onResize(renderer.domElement);
            });

            // Инициализация Three.js
            const scene = new THREE.Scene();
            const camera = new THREE.Camera();
            scene.add(camera);

            const renderer = new THREE.WebGLRenderer({
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.domElement.style.position = 'absolute';
            renderer.domElement.style.top = '0px';
            renderer.domElement.style.left = '0px';
            document.body.appendChild(renderer.domElement);

            // Настройка контекста AR
            const arToolkitContext = new THREEx.ArToolkitContext({
                cameraParametersUrl: 'https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/camera_para.dat',
                detectionMode: 'mono',
                maxDetectionRate: 30,
                canvasWidth: 80*3,
                canvasHeight: 60*3
            });

            arToolkitContext.init(function onCompleted() {
                camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
            });

            // Создание маркера HIRO
            const markerRoot = new THREE.Group();
            scene.add(markerRoot);
            const markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot, {
                type: 'pattern',
                patternUrl: 'https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro',
                changeMatrixMode: 'modelViewMatrix'
            });

            // Добавление 3D объекта на маркер
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshNormalMaterial({
                transparent: true,
                opacity: 0.5,
                side: THREE.DoubleSide
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.y = 0.5;
            markerRoot.add(mesh);

            // Анимация
            function animate() {
                requestAnimationFrame(animate);
                
                if (arToolkitSource.ready) {
                    arToolkitContext.update(arToolkitSource.domElement);
                }
                
                renderer.render(scene, camera);
            }
            
            animate();
        }
    </script>
</body>
</html>